{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Bootstrap 101 Template</title>


	<link rel="stylesheet" href="{% static "bootstrap-3.3.7-dist/css/bootstrap.min.css" %}" />
	<link rel="stylesheet" href="{% static "bootstrap-3.3.7-dist/css/bootstrap-theme.min.css" %}" />
	<link rel="stylesheet" href="{% static "bootstrap-toggle-master/css/bootstrap-toggle.min.css" %}" />
	<script type="text/javascript" src="{% static "jquery/jquery-3.1.1.min.js" %}"></script>
	<script type="text/javascript" src="{% static "bootstrap-3.3.7-dist/js/bootstrap.min.js" %}"></script>
	<script type="text/javascript" src="{% static "bootstrap-toggle-master/js/bootstrap-toggle.min.js" %}"></script>
	<script type="text/javascript" src="{% static "js/ws4redis.js" %}"></script>


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <h1>Hello, world!</h1>

	<b>Notifications on telnet:</b>
	<ol id="notification">
	</ol>

	<script>

		var ws_url = 'ws://' + window.location.host + '/ws/foobar?subscribe-broadcast&publish-broadcast';
		var ws4redis;

		$(function() {
			start_connection();
		});

		function start_connection()
		{
			console.log("making websocket connection to " + ws_url);
			ws4redis = WS4Redis({
				uri: ws_url,
				connecting: on_connecting,
				connected: on_connected,
				disconnected: on_disconnected,
				receive_message: receiveMessage,
			});
		}

		function stop_connection()
		{
			ws4redis.close();
		}

		function on_connecting() {
			console.log("making websocket connection to " + ws_url);
		}

		function on_connected() {
			console.log("WS connected");
		}

		function on_disconnected(evt) {
			console.log('Websocket was disconnected: ' + JSON.stringify(evt));
		}

		var messages = 0;
		function receiveMessage(data) {
			if(data == undefined)
				return;

			var $notification = $("#notification");

			if(messages == 10)
			{
				$notification.html("");
				messages = 0;
			}

			$notification.append("<li>" + data + "</li>");
			messages += 1;
		};

	</script>
  </body>
</html>
